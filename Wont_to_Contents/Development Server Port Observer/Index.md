以下は、技術選定後の情報を表形式でまとめたものです。`ratatui-rs`（旧tui-rs）を使ってターミナル上でCLIを構築する前提で、開発状況や選定理由、役割などを整理しています。

### 🧾 技術選定後の情報整理表

|項目|内容|
|---|---|
|🛠️ 開発目的|Claude Code開発サーバの開放状態を監視・制御するCLIツールの作成|
|🎯 主な課題|開発サーバが操作後も自動で閉じられず、ポートが開きっぱなしになること|
|✅ 解決方針|- CLIツールでポート監視を行う- 状況をユーザーに提示し操作可能にする- 必要に応じて再起動や停止を支援|
|🧰 使用技術|Rust, ratatui-rs（ターミナルUI）, `sysinfo` or `netstat2` for port監視|
|🔌 監視対象|`localhost:{port}`（例: 5173, 3000など）|
|📊 UI構成|- リアルタイムに更新されるポートリスト表示- 各プロセスのPID・ポート・起動元表示- 操作：終了 / 再起動 / 状態送信（Claude Code側へ）|
|📦 想定crate|- `ratatui`：TUI描画- `crossterm`：ターミナル制御- `sysinfo`：プロセス・ポート情報収集- `tokio`：非同期制御|
|🚧 開発ステータス|技術選定済み、構成設計段階（UIワイヤフレーム／内部処理フロー検討中）|
|🧩 Claude連携|Claude Code側にCLI経由で「現在の開放状態」等をPOST/送信する機構|

### 🧩 機能一覧（初期リリース予定）

|機能名|説明|優先度|
|---|---|---|
|ポート監視|現在開放中のポートをリアルタイム表示|高|
|プロセス制御|PIDを指定してプロセスを終了／再起動できる|高|
|Claude通知|Claude Codeへ現在の状態を送信（Webhookなど想定）|中|
|設定ファイル読込|ユーザ設定（監視ポート、通知先URLなど）を読み込む|中|
|自動終了|一定時間未操作時に開放ポートを自動で閉じる|低|

## 🖼️ ratatui を使った画面レイアウト案

```
┌────────────────────────────────────────────────────────────┐
│ Claude Code Port Monitor CLI                               │
├─────────────┬─────────────┬─────────────┬─────────────────┤
│ Port        │ Status      │ PID         │ Command         │
├─────────────┼─────────────┼─────────────┼─────────────────┤
│ 5173        │ LISTENING   │ 12345       │ npm run dev     │
│ 3000        │ LISTENING   │ 12347       │ next dev        │
│ 8080        │ CLOSED      │ -           │ -               │
├─────────────┴─────────────┴─────────────┴─────────────────┤
│ [↑↓]: 移動  [Enter]: 操作メニュー  [Q]: 終了              │
└────────────────────────────────────────────────────────────┘
```

- **上部ヘッダー**にタイトル
    
- **中央のテーブル**に「監視中のポート情報」
    
- **キー操作案内**を下部に表示
    
- テーブル選択時に`Enter`で以下のような操作メニューが開く（別画面）
    

## 🎛️ 操作メニューレイアウト（ポートを選択してEnter）

```
┌────────────────────────────┐
│ 操作: ポート 5173 (PID: 12345) │
├────────────────────────────┤
│ 1. プロセスを終了する        │
│ 2. プロセスを再起動する      │
│ 3. Claude Codeに状態を通知   │
│ 4. 戻る                      │
└────────────────────────────┘
```

## 🧠 状態管理の構成案（Stateパターン）

CLIは複数の状態（ビュー）を持つため、**状態パターン**を導入すると保守性が向上します。

### 🎯 主な状態（アプリの状態ツリー）

```rust
enum AppState {
    PortList,        // ポートリストを表示中
    OperationMenu { selected_port: PortInfo }, // ポート選択時のメニュー
    NotifyingClaude, // Claude Codeに通知中（進行状況表示など）
    ExitConfirm,     // 終了確認ダイアログ
}
```

### 🔁 状態遷移イメージ

```
PortList ──[Enter]──> OperationMenu ──[1 or 2 or 3]──> PortList
    ↑                                 ↓
    └───────[q]─────── ExitConfirm <──┘
```

### 💡 補足: `PortInfo` 構造体例

```rust
struct PortInfo {
    port: u16,
    status: String,
    pid: Option<u32>,
    command: Option<String>,
}
```

## 🧱 実装構成案（Module設計）

```text
src/
├── main.rs                // エントリポイント
├── app.rs                 // App構造体と状態管理（AppState）
├── ui/
│   ├── layout.rs          // UIレイアウト構築（ratatui widgets）
│   ├── port_list.rs       // ポート一覧のUI描画
│   └── menu.rs            // 操作メニューの描画
├── monitor/
│   └── port.rs            // ポート情報の取得（netstat/sysinfo）
├── notify/
│   └── claude.rs          // Claude Code連携ロジック
```

## ✨ 今後拡張を想定するポイント

|機能|想定技術／ライブラリ|
|---|---|
|非同期監視|`tokio`, `async-process`|
|自動終了のトリガー検出|`idle-time` / タイマー処理|
|設定ファイルサポート|`serde`, `toml`, `dirs`|
|ログ保存|`tracing`, `log`|
|CLI引数|`clap`|
