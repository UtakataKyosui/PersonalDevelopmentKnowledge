
# 🌐 PortWatchMoon 機能要件定義一覧（v0.1 設計段階）

Claude Codeなどの開発時に開放されたポートや開発サーバをTUI上でリアルタイム監視・操作・通知できるCLIツール。

---

## ✅ 1. TUIベースのポート監視・プロセス制御

|項目|内容|
|---|---|
|機能名|ポート監視UI（ratatui）|
|ユースケース|開発中に開放されたポートとそのプロセス状態を一覧表示・選択操作する|
|入力|`netstat`, `lsof`, `sysinfo`等で取得したローカルポート情報|
|出力|TUIテーブル表示、選択によるプロセス終了・通知などの操作|
|操作|↑↓で選択、Enter: メニュー表示、`k`: kill、`r`: restart、`s`: 状態送信|
|成功条件|ポートの開放状況が即時に表示され、操作がシステムに反映されること|

---

## ✅ 2. 開発サーバ起動検知 & 状態トラッキング

|項目|内容|
|---|---|
|機能名|サーバ状態検知|
|ユースケース|Claude Codeや他の開発環境が開発サーバ（例: Vite, Next.js）を起動した検知|
|入力|特定ポートの開放状態、プロセスコマンド内容、PID|
|出力|セッションとして内部記録、再起動や状態通知の対象として扱う|
|成功条件|ポート開放後すぐにリストに反映され、監視対象として自動登録されること|

---

## ✅ 3. 操作メニューの提供（プロセス制御）

|項目|内容|
|---|---|
|機能名|ポート操作メニュー|
|ユースケース|特定ポートを選択してプロセス終了・再起動などを行う|
|入力|TUI操作によるポート選択|
|出力|プロセスkill、コマンド再起動、Claudeへの通知等|
|成功条件|実行した操作がPIDに反映され、視覚的にフィードバックされること|

---

## ✅ 4. Claude Codeとの連携通知

|項目|内容|
|---|---|
|機能名|Claude Code通知|
|ユースケース|現在のポート開放状態をClaude Code側に通知（Webhook/API連携）|
|入力|開放ポート情報、セッションID、設定ファイルに記述された送信先URL|
|出力|HTTP POSTリクエスト等|
|成功条件|Claude Codeが受信し、状態更新またはSlack通知などに活用されること|

---

## ✅ 5. `.portwatchmoon` ディレクトリ管理

|項目|内容|
|---|---|
|機能名|セッションログ・構成保存|
|ユースケース|各監視対象の履歴や通知ログ、設定ファイルを保持|
|入力|CLIまたはTUI操作|
|出力|`.portwatchmoon/` にセッション履歴、通知履歴、設定などを保存|
|成功条件|再起動後も前回のポート状態・通知履歴が復元される|

---

## ✅ 6. CLIサブコマンド対応（非TUI操作）

|項目|内容|
|---|---|
|機能名|CLI操作インターフェース|
|ユースケース|`portmoon list`, `portmoon kill`, `portmoon notify` などの操作|
|入力|サブコマンドとオプション|
|出力|stdoutによる操作結果、TUIと共通のセッション管理|
|成功条件|TUIと同様の情報にアクセス・制御が可能|

---

## ✅ 7. 自動終了／スリープ機能（将来）

|項目|内容|
|---|---|
|機能名|自動終了機能|
|ユースケース|ポートが一定時間アクティブでなければ自動終了させる|
|入力|アイドル時間、プロセス監視情報|
|出力|プロセスkill or ユーザ通知|
|成功条件|不要なポートが放置されることなく自動的に閉じられる|

---

## 📁 想定ディレクトリ構成例

```
project-root/  
├── .portwatchmoon/  
│ ├── config.toml  
│ ├── sessions/  
│ ├── notify/  
│ └── logs/  
```

---

## 🧠 今後の検討ポイント

- Windowsプラットフォーム対応（port取得方法をOS依存で切替）
    
- 通知先の柔軟化（Slack, Discord, Claude Webhookなど）
    
- セッション記録から傾向分析（よく開かれるポートなど）
    
- TUIとCLIのロック・排他制御（同時使用時の整合性確保）
    
